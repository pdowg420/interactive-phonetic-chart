<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Phonetic Chart</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-image: url('images/background.png'); /* Updated background image */
            background-size: cover; /* Ensures the image covers the entire background */
            background-position: center; /* Centers the image */
            background-color: #333; /* Fallback background color */
        }
        .chart-button {
            display: inline-block;
            margin: 5px;
            padding: 15px; /* Increased padding for bigger buttons */
            border: 1px solid #ccc;
            border-radius: 4px;
            cursor: pointer;
        }
        .chart-button:hover {
            background-color: #f0f0f0;
        }
        .highlighted {
            background-color: yellow;
        }
        #vowel-sounds, #consonant-sounds, #follow-along {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin: 20px 0;
        }
        #controls {
            margin: 20px 0;
        }
        .play-button {
            font-size: 20px;
            padding: 10px;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            margin-left: 10px;
        }
        .play-button:hover {
            background-color: #45a049;
        }
        .tooltip {
            position: absolute;
            background-color: yellow;
            border: 1px solid black;
            padding: 5px;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <h1>Interactive Phonetic Chart</h1>
    <div id="vowel-sounds"></div>
    <div id="consonant-sounds"></div>
    <div id="follow-along">
        <h2>Follow Along Chart</h2>
        <button class="play-button" onclick="playSelectedSounds()">Play Selected Sounds</button>
    </div>
    <div id="controls">
        <button onclick="clearFollowAlong()">Clear Follow Along Chart</button>
        <button onclick="clearHighlights()">Clear Highlights</button>
    </div>

    <script>
        const phoneticSounds = {
            vowels: {
                "a": "Sounds/sound_a.mp3",
                "e": "Sounds/sound_e.mp3",
                "i": "Sounds/sound_i.mp3",
                "o": "Sounds/sound_o.mp3",
                "u": "Sounds/sound_u.mp3",
                "aÉª": "Sounds/sound_ai.mp3"
            },
            consonants: {
                "b": "Sounds/sound_b.mp3",
                "d": "Sounds/sound_d.mp3",
                "f": "Sounds/sound_f.mp3",
                "g": "Sounds/sound_g.mp3",
                "h": "Sounds/sound_h.mp3"
            }
        };

        let isPlaying = false; // Variable to check if sounds are being played

        function playSound(filePath) {
            console.log(`DEBUG: Attempting to play sound from: ${filePath}`);
            const audio = new Audio(filePath);
            return audio.play().then(() => {
                console.log(`DEBUG: Successfully playing sound from: ${filePath}`);
            }).catch(error => {
                console.error(`ERROR: Failed to play sound ${filePath}: ${error}`);
                alert(`Failed to play sound from ${filePath}. Please check if the file exists.`);
            });
        }

        function getUserName() {
            const name = prompt("Please enter your name:");
            console.log(`DEBUG: User entered name: ${name}`);
            if (name) {
                welcomeUser(name);
            }
        }

        function welcomeUser(name) {
            const welcomeLabel = document.createElement('h2');
            welcomeLabel.textContent = `Welcome, ${name}! Enjoy your interactive phonetic chart.`;
            document.body.prepend(welcomeLabel);
            console.log(`DEBUG: Welcome message displayed for: ${name}`);

            const welcomeMessage = `Welcome, ${name}! Enjoy your interactive phonetic chart.`;
            const utterance = new SpeechSynthesisUtterance(welcomeMessage);
            utterance.pitch = 1.2; // Adjust pitch for a more natural sound
            utterance.rate = 1; // Normal speaking rate

            let voicesLoaded = false;

            function setVoice() {
                if (!voicesLoaded) {
                    const voices = window.speechSynthesis.getVoices();
                    console.log('DEBUG: Voices loaded:', voices);
                    const femaleVoice = voices.find(voice => voice.name.includes('Female') || voice.lang.includes('en-US'));
                    if (femaleVoice) {
                        utterance.voice = femaleVoice;
                        console.log(`DEBUG: Selected voice: ${femaleVoice.name}`);
                    } else {
                        console.error('ERROR: No suitable female voice found.');
                    }
                    voicesLoaded = true; // Ensure voices are only loaded once
                }
                window.speechSynthesis.speak(utterance);
            }

            // Ensure voices are loaded and set only once
            if (window.speechSynthesis.onvoiceschanged !== undefined) {
                window.speechSynthesis.onvoiceschanged = setVoice;
            } else {
                setVoice();
            }
        }

        function createButton(symbol, soundFile, container) {
            const button = document.createElement('div');
            button.className = 'chart-button';
            button.innerHTML = `<img src='Sounds/sound-icon.png' alt='Play Sound' style='width:20px;height:20px;' /> /${symbol}/`; // Added sound icon
            button.onclick = () => handleButtonClick(button, soundFile);
            button.onmouseover = () => showTooltip(button, `Play sound: /${symbol}/`);
            button.onmouseout = () => hideTooltip(button);
            container.appendChild(button);
            console.log(`DEBUG: Added button for /${symbol}/ with sound file ${soundFile}`);
        }

        function handleButtonClick(button, soundFile) {
            playSound(soundFile);
            button.classList.add('highlighted');
            const clone = button.cloneNode(true);
            clone.dataset.soundFile = soundFile; // Store the sound file path in the cloned button
            clone.classList.remove('highlighted');
            document.getElementById('follow-along').appendChild(clone);
        }

        function showTooltip(element, text) {
            const tooltip = document.createElement('div');
            tooltip.className = 'tooltip';
            tooltip.textContent = text;
            tooltip.style.position = 'absolute';
            tooltip.style.backgroundColor = 'yellow';
            tooltip.style.border = '1px solid black';
            tooltip.style.padding = '5px';
            tooltip.style.zIndex = '1000';
            document.body.append(tooltip);

            const rect = element.getBoundingClientRect();
            tooltip.style.left = `${rect.left + window.scrollX}px`;
            tooltip.style.top = `${rect.top + window.scrollY - tooltip.offsetHeight}px`;

            element.tooltip = tooltip;
        }

        function hideTooltip(element) {
            if (element.tooltip) {
                element.tooltip.remove();
                element.tooltip = null;
            }
        }

        function clearFollowAlong() {
            const followAlongDiv = document.getElementById('follow-along');
            followAlongDiv.innerHTML = '<h2>Follow Along Chart</h2><button class="play-button" onclick="playSelectedSounds()">Play Selected Sounds</button>';
            console.log('DEBUG: Follow Along Chart cleared');
        }

        function clearHighlights() {
            const highlightedButtons = document.querySelectorAll('.chart-button.highlighted');
            highlightedButtons.forEach(button => button.classList.remove('highlighted'));
            console.log('DEBUG: Highlights cleared');
        }

        async function playSelectedSounds() {
            if (isPlaying) return; // Prevent multiple playbacks at the same time

            const followAlongDiv = document.getElementById('follow-along');
            const buttons = followAlongDiv.querySelectorAll('div.chart-button');
            let delay = 500; // Play each sound 0.5 seconds apart

            isPlaying = true; // Set playing flag to true

            for (const button of buttons) {
                const soundFile = button.dataset.soundFile;
                await new Promise(resolve => setTimeout(resolve, delay));
                await playSound(soundFile);
            }

            isPlaying = false; // Reset playing flag after all sounds are played

            console.log('DEBUG: Playing selected sounds in order');
        }

        function init() {
            getUserName(); // Prompt for the user's name and trigger the welcome message

            const vowelSoundsDiv = document.getElementById('vowel-sounds');
            for (const [symbol, soundFile] of Object.entries(phoneticSounds.vowels)) {
                createButton(symbol, soundFile, vowelSoundsDiv);
            }

            const consonantSoundsDiv = document.getElementById('consonant-sounds');
            for (const [symbol, soundFile] of Object.entries(phoneticSounds.consonants)) {
                createButton(symbol, soundFile, consonantSoundsDiv);
            }
        }

        window.onload = init;
    </script>
</body>
</html>